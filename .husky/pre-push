#!/bin/bash

echo "ğŸš€ Pre-push checks starting..."

# Ejecutar linting con fix y formatting
echo "ğŸ”§ Running linting and formatting..."
pnpm run lint:fix
pnpm run format

# Verificar si hay cambios despuÃ©s del lint y format
if [ -n "$(git diff --name-only)" ]; then
  echo "âš ï¸  Linting and formatting fixes found. Adding changes and creating style commit..."
  
  # Obtener el Ãºltimo commit message
  LAST_COMMIT_MSG=$(git log -1 --pretty=%s)
  
  # Extraer la descripciÃ³n del Ãºltimo commit (sin el tipo)
  COMMIT_DESC=$(echo "$LAST_COMMIT_MSG" | sed 's/^[a-z]*[(:][^:]*[):]*[ ]*//')
  
  # Agregar los cambios del linting y formatting
  git add .
  
  # Crear commit de estilo automÃ¡tico
  git commit -m "style: $COMMIT_DESC"
  
  echo "âœ… Style commit created automatically"
fi

# Ejecutar build para verificar que todo compila
echo "ğŸ—ï¸  Building project..."
pnpm run build

if [ $? -eq 0 ]; then
  echo "âœ… Pre-push checks passed!"
else
  echo "âŒ Build failed. Push aborted."
  exit 1
fi