#!/bin/bash

echo "üöÄ Pre-commit checks starting..."

# Ejecutar linting con fix
echo "üîß Running linting..."
pnpm run lint:fix

# Ejecutar formatting
echo "üíÖ Running formatting..."
pnpm run format

# Verificar si hay cambios despu√©s del lint y format
if [ -n "$(git diff --name-only)" ]; then
  echo "üîß Linting and formatting fixes applied. Adding changes and creating style commit..."
  
  # Obtener el mensaje del commit actual
  COMMIT_MSG=$(cat .git/COMMIT_EDITMSG 2>/dev/null || echo "code formatting")
  
  # Extraer solo la descripci√≥n del commit (sin el tipo)
  COMMIT_DESC=$(echo "$COMMIT_MSG" | sed 's/^[a-z]*[(:][^:]*[):]*[ ]*//')
  
  # Agregar los cambios del linting y formatting
  git add .
  
  # Crear commit de estilo autom√°tico
  git commit -m "style: $COMMIT_DESC"
  
  echo "‚úÖ Style commit created automatically"
fi
